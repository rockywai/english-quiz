<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DSE è‹±æ–‡è©å½™æŒ‘æˆ° V2.1</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root { --primary: #4f46e5; --primary-light: #eef2ff; --success: #22c55e; --danger: #ef4444; --text: #374151; }
        body { font-family: 'Noto Sans TC', sans-serif; background: #f3f4f6; display: flex; justify-content: center; padding: 15px; color: var(--text); line-height: 1.6; }
        .container { width: 100%; max-width: 550px; background: white; padding: 25px; border-radius: 20px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); }
        h2 { text-align: center; color: var(--primary); margin-top: 0; }
        .btn { width: 100%; padding: 12px; margin: 8px 0; border: 2px solid transparent; border-radius: 12px; cursor: pointer; font-size: 16px; background: var(--primary-light); color: var(--primary); font-weight: 600; transition: all 0.2s; text-align: left; display: flex; align-items: center; }
        .btn:hover { background: #e0e7ff; transform: translateY(-1px); }
        .option-btn { background: white; border: 1px solid #d1d5db; color: var(--text); font-weight: normal; }
        .correct { background: #dcfce7 !important; border-color: var(--success) !important; color: #166534 !important; }
        .wrong { background: #fee2e2 !important; border-color: var(--danger) !important; color: #991b1b !important; }
        .hidden { display: none; }
        
        /* æ–‡ç« é–±è®€å€æ¨£å¼ */
        .article-box { background: #fffbeb; border: 1px solid #fde68a; padding: 15px; border-radius: 12px; margin-bottom: 20px; max-height: 200px; overflow-y: auto; font-size: 1rem; color: #4b5563; }
        .highlight-word { background-color: #fef08a; font-weight: bold; border-bottom: 2px solid #facc15; padding: 0 2px; }
        
        /* é€²åº¦èˆ‡æç¤º */
        .progress-container { background: #e5e7eb; border-radius: 10px; height: 6px; margin-bottom: 5px; }
        .progress-bar { height: 100%; background: var(--primary); width: 0%; transition: width 0.3s; }
        .progress-text { text-align: center; font-size: 0.8rem; color: #6b7280; margin-bottom: 15px; }
        
        /* åé¥‹å€ */
        .feedback-box { background: var(--primary-light); padding: 15px; border-radius: 15px; margin-top: 15px; display: none; border: 1px solid var(--primary); }
        .feedback-box.show { display: block; animation: fadeIn 0.3s; }
        .fb-example { font-style: italic; color: #4b5563; background: white; padding: 10px; border-radius: 8px; margin-top: 10px; font-size: 0.9rem; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>

<div class="container">
    <div id="setup-screen">
        <h2>DSE è©å½™è‡ªå­¸ç«™</h2>
        <p style="text-align:center; color: #6b7280;">é–±è®€åŸæ–‡ä¸¦æŒ‘æˆ°è©å½™æ„æ€</p>
        <div id="article-list" style="margin-top: 20px;"></div>
    </div>

    <div id="quiz-screen" class="hidden">
        <div id="quiz-header">
            <div class="progress-container"><div class="progress-bar" id="progress-bar"></div></div>
            <div class="progress-text" id="progress-text"></div>
        </div>

        <div class="article-box" id="article-display"></div>

        <div id="question-area">
            <p style="margin: 0; color: #6b7280; font-size: 0.9rem;">æ–‡ä¸­ç²—é«”å­—æ„æ€ç‚ºï¼š</p>
            <h2 id="word-display" style="font-size: 2.2rem; margin: 5px 0 15px 0;"></h2>
            <div id="options-box"></div>
        </div>

        <div id="feedback-box" class="feedback-box">
            <div id="fb-content"></div>
            <button class="btn" style="background: var(--primary); color: white; justify-content: center; margin-top: 15px;" onclick="nextQuestion()">ä¸‹ä¸€é¡Œ ğŸ‘‰</button>
        </div>
    </div>

    <div id="result-screen" class="hidden" style="text-align: center;">
        <div style="font-size: 4rem;">ğŸ†</div>
        <h2>å®ŒæˆæŒ‘æˆ°ï¼</h2>
        <p>ä½ å·²æŒæ¡æœ¬ç¯‡æ–‡ç« çš„æ‰€æœ‰é‡é»å–®å­—ã€‚</p>
        <button class="btn" style="background: var(--primary); color: white; justify-content: center;" onclick="location.reload()">æŒ‘æˆ°å…¶ä»–æ–‡ç« </button>
    </div>
</div>

<script>
/* ==================================================================
   è€å¸«æ›´æ–°æ•¸æ“šå€ï¼šæˆ‘æœƒæ ¹æ“šä½ æä¾›çš„é€£çµç‚ºä½ ç”Ÿæˆé€™éƒ¨åˆ†çš„å…§å®¹
   ================================================================== */
const newsData = [
    {
        title: "Storm Goretti Hits Europe",
        level: 1,
        content: "A big storm is hitting Europe. It is called Storm Goretti. The **storm** is moving across many countries. It brings very strong wind and heavy rain. Many people have no **power** in their homes. This is because the wind broke the lines. The storm is **dangerous** for travelers. Many **flights** are not moving. The storm will **hit** more places tomorrow.",
        vocab: [
            { w: "storm", pos: "n.", d: "bad weather with wind and rain", chinese: "é¢¨æš´", example: "The storm lasted for three days." },
            { w: "power", pos: "n.", d: "electricity", chinese: "é›»åŠ›", example: "The storm cut off the power." },
            { w: "dangerous", pos: "adj.", d: "not safe", chinese: "å±éšªçš„", example: "It's dangerous to go out now." },
            { w: "flights", pos: "n.", d: "journeys in a plane", chinese: "èˆªç­", example: "All flights were delayed." },
            { w: "hit", pos: "v.", d: "to come to a place with force", chinese: "ä¾µè¥²", example: "The storm hit the coast at midnight." }
        ]
    },
    {
        title: "Storm Goretti Hits Europe",
        level: 3,
        content: "Storm Goretti is currently **wreaking havoc** across the European continent, bringing winds of **unprecedented** strength. Experts from various **meteorological** stations are monitoring its path closely. The storm has severely impacted the region's **infrastructure**, causing widespread blackouts and transport chaos. Authorities are working to **verify** reports of damage in remote areas.",
        vocab: [
            { w: "wreak havoc", pos: "phr.", d: "to cause a lot of damage", chinese: "é€ æˆåš´é‡ç ´å£", example: "The hurricane wreaked havoc on the islands." },
            { w: "unprecedented", pos: "adj.", d: "never happened before", chinese: "å²ç„¡å‰ä¾‹çš„", example: "This year's rainfall is unprecedented." },
            { w: "meteorological", pos: "adj.", d: "related to the weather", chinese: "æ°£è±¡çš„", example: "The meteorological office issued a warning." },
            { w: "infrastructure", pos: "n.", d: "basic systems like roads/power", chinese: "åŸºç¤å»ºè¨­", example: "The earthquake destroyed the city's infrastructure." },
            { w: "verify", pos: "v.", d: "to check if something is true", chinese: "æ ¸å¯¦", example: "We need to verify the information." }
        ]
    }
];

/* ==========================================
   ç¨‹å¼é‚è¼¯å€
   ========================================== */
let currentArticle = null;
let currentPool = [];
let wrongFromLastRound = [];
let currentIndex = 0;

const articleList = document.getElementById('article-list');
newsData.forEach((item, index) => {
    const btn = document.createElement('button');
    btn.className = 'btn';
    btn.innerHTML = `<div><strong>Level ${item.level}</strong>: ${item.title}</div>`;
    btn.onclick = () => startQuiz(index);
    articleList.appendChild(btn);
});

function startQuiz(index) {
    currentArticle = newsData[index];
    document.getElementById('setup-screen').classList.add('hidden');
    document.getElementById('quiz-screen').classList.remove('hidden');
    
    // åˆå§‹åŒ–æ–‡ç« é¡¯ç¤ºï¼ˆåŠ å…¥é«˜äº®ï¼‰
    let highlightedContent = currentArticle.content;
    currentArticle.vocab.forEach(v => {
        // ä½¿ç”¨æ­£å‰‡è¡¨é”å¼é€²è¡Œä¸åˆ†å¤§å°å¯«çš„æ›¿æ›
        const regex = new RegExp(`\\*\\*(${v.w})\\*\\*`, 'gi');
        highlightedContent = highlightedContent.replace(regex, `<span class="highlight-word">$1</span>`);
    });
    document.getElementById('article-display').innerHTML = highlightedContent;
    
    startNewRound(shuffle([...currentArticle.vocab]).slice(0, 5));
}

function startNewRound(words) {
    currentPool = words;
    wrongFromLastRound = [];
    currentIndex = 0;
    showQuestion();
}

function showQuestion() {
    if (currentIndex >= currentPool.length) {
        checkRoundEnd();
        return;
    }
    
    // æ›´æ–°é€²åº¦æ¢
    const percent = (currentIndex / currentPool.length) * 100;
    document.getElementById('progress-bar').style.width = `${percent}%`;
    document.getElementById('progress-text').innerText = `é¡Œç›® ${currentIndex + 1} / ${currentPool.length}`;
    document.getElementById('feedback-box').classList.remove('show');
    
    const currentQ = currentPool[currentIndex];
    document.getElementById('word-display').innerText = currentQ.w;
    
    const optionsBox = document.getElementById('options-box');
    optionsBox.innerHTML = "";

    let options = shuffle([currentQ, ...shuffle(currentArticle.vocab.filter(v => v.w !== currentQ.w)).slice(0, 3)]);

    options.forEach(opt => {
        const btn = document.createElement('button');
        btn.className = 'btn option-btn';
        btn.innerText = opt.d.split('/')[0].trim();
        btn.onclick = () => {
            disableButtons();
            const isCorrect = opt.w === currentQ.w;
            if (isCorrect) {
                btn.classList.add('correct');
            } else {
                btn.classList.add('wrong');
                wrongFromLastRound.push(currentQ);
                // é¡¯ç¤ºæ­£ç¢ºç­”æ¡ˆ
                document.querySelectorAll('.option-btn').forEach(b => {
                    if(b.innerText === currentQ.d.split('/')[0].trim()) b.classList.add('correct');
                });
            }
            showFeedback(currentQ, isCorrect);
        };
        optionsBox.appendChild(btn);
    });
}

function showFeedback(q, isCorrect) {
    const fb = document.getElementById('fb-content');
    fb.innerHTML = `
        <div style="font-weight:bold; color:${isCorrect ? 'var(--success)' : 'var(--danger)'}">
            ${isCorrect ? 'âœ… æ­£ç¢ºï¼Correct' : 'âŒ ç­”éŒ¯äº†ï¼Œå†æ¥å†å²ï¼'}
        </div>
        <div style="margin-top:5px;"><strong>${q.w}</strong> (${q.pos} ${q.chinese})</div>
        <div class="fb-example">Example: ${q.example}</div>
    `;
    document.getElementById('feedback-box').classList.add('show');
}

function nextQuestion() {
    currentIndex++;
    showQuestion();
}

function disableButtons() {
    document.querySelectorAll('.option-btn').forEach(b => b.style.pointerEvents = 'none');
}

function checkRoundEnd() {
    if (wrongFromLastRound.length === 0) {
        document.getElementById('quiz-screen').classList.add('hidden');
        document.getElementById('result-screen').classList.remove('hidden');
    } else {
        alert(`é€™è¼ªçµæŸï¼Œç¾åœ¨é‡æ–°æŒ‘æˆ° ${wrongFromLastRound.length} å€‹ç­”éŒ¯çš„å–®å­—ã€‚`);
        startNewRound(shuffle([...wrongFromLastRound]));
    }
}

function shuffle(array) {
    return array.sort(() => Math.random() - 0.5);
}
</script>
</body>
</html>
