<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DSE English Vocab Builder</title>
    <style>
        :root { --primary: #2563eb; --bg: #f8fafc; }
        body { font-family: 'Segoe UI', Tahoma, sans-serif; background: var(--bg); display: flex; justify-content: center; padding: 20px; }
        .container { width: 100%; max-width: 500px; background: white; padding: 25px; border-radius: 15px; box-shadow: 0 10px 15px -3px rgba(0,0,0,0.1); }
        .header { text-align: center; margin-bottom: 20px; }
        .btn { width: 100%; padding: 12px; margin: 8px 0; border: 1px solid #e2e8f0; border-radius: 8px; cursor: pointer; font-size: 16px; background: white; transition: all 0.2s; text-align: left; }
        .btn:hover { background: #f1f5f9; border-color: var(--primary); }
        .correct { background: #dcfce7 !important; border-color: #22c55e !important; }
        .wrong { background: #fee2e2 !important; border-color: #ef4444 !important; }
        .hidden { display: none; }
        .progress { font-size: 14px; color: #64748b; margin-bottom: 10px; }
        .article-title { font-weight: bold; color: var(--primary); margin-bottom: 20px; }
    </style>
</head>
<body>

<div class="container">
    <div id="setup-screen">
        <div class="header">
            <h2>æ¯æ—¥è©å½™æŒ‘æˆ°</h2>
            <p>å°è±¡ï¼šä¸­äº”ç´šå­¸ç”Ÿ (Form 5)</p>
        </div>
        <p>è«‹é¸æ“‡ä»Šå¤©çš„æ–‡ç« èˆ‡é›£åº¦ï¼š</p>
        <div id="article-list"></div>
    </div>

    <div id="quiz-screen" class="hidden">
        <div class="article-title" id="current-article-display"></div>
        <div class="progress" id="progress-text"></div>
        <h2 id="word-display" style="font-size: 28px; margin: 10px 0;"></h2>
        <div id="options-box"></div>
        <p id="feedback" style="margin-top: 15px; font-weight: 500; min-height: 24px;"></p>
    </div>

    <div id="result-screen" class="hidden" style="text-align: center;">
        <h2 style="color: #059669;">ğŸ‰ ä»»å‹™å®Œæˆï¼</h2>
        <p>ä½ å·²ç¶“æŒæ¡äº†æœ¬æ¬¡æ–‡ç« çš„æ‰€æœ‰é‡é»è©å½™ã€‚</p>
        <button class="btn" style="text-align: center; background: var(--primary); color: white;" onclick="location.reload()">å›åˆ°ä¸»é </button>
    </div>
</div>

<script>
/* ==========================================
   è€å¸«æ›´æ–°æ•¸æ“šå€ï¼šæ¯å¤©åªéœ€åœ¨é€™è£¡æ·»åŠ æ–°æ–‡ç« 
   ========================================== */
const newsData = [
    {
        title: "Japan's Empty Houses",
        level: 1,
        vocab: [
            { w: "empty", d: "with nothing inside" },
            { w: "owner", d: "a person who has something / boss" },
            { w: "area", d: "a part of a place" },
            { w: "problem", d: "something bad" },
            { w: "solution", d: "an answer to a problem" }
        ]
    },
    {
        title: "Global Warming Effects",
        level: 2,
        vocab: [
            { w: "consequence", d: "a result of an action" },
            { w: "dramatic", d: "sudden and striking" },
            { w: "essential", d: "extremely important / necessary" },
            { w: "expand", d: "to become larger" },
            { w: "predict", d: "to say what will happen" }
        ]
    },
    {
        title: "The Future of AI",
        level: 3,
        vocab: [
            { w: "unprecedented", d: "never done or known before" },
            { w: "innovation", d: "a new method or idea" },
            { w: "ethical", d: "relating to moral principles / right or wrong" },
            { w: "implement", d: "to put into effect" },
            { w: "ubiquitous", d: "present everywhere" }
        ]
    }
];

/* ==========================================
   ç¨‹å¼é‚è¼¯å€ï¼šè«‹å‹¿éš¨æ„æ›´å‹•
   ========================================== */
let currentPool = []; // ç•¶å‰è¦è€ƒçš„è©
let allWordsInArticle = []; // è©²ç¯‡æ–‡ç« å…¨éƒ¨è©å½™ï¼ˆä½œå¹²æ“¾é …ï¼‰
let wrongFromLastRound = [];
let currentIndex = 0;

// åˆå§‹åŒ–ï¼šç”Ÿæˆæ–‡ç« åˆ—è¡¨
const articleList = document.getElementById('article-list');
newsData.forEach((item, index) => {
    const btn = document.createElement('button');
    btn.className = 'btn';
    btn.innerHTML = `<strong>Level ${item.level}</strong>: ${item.title}`;
    btn.onclick = () => initQuiz(index);
    articleList.appendChild(btn);
});

function initQuiz(index) {
    const selected = newsData[index];
    allWordsInArticle = selected.vocab;
    document.getElementById('current-article-display').innerText = `æ­£åœ¨ç·´ç¿’ï¼š${selected.title} (Level ${selected.level})`;
    document.getElementById('setup-screen').classList.add('hidden');
    document.getElementById('quiz-screen').classList.remove('hidden');
    
    // ç¬¬ä¸€è¼ªï¼šéš¨æ©Ÿé¸5é¡Œ
    startNewRound(shuffle([...allWordsInArticle]).slice(0, 5));
}

function startNewRound(words) {
    currentPool = shuffle(words);
    wrongFromLastRound = [];
    currentIndex = 0;
    showQuestion();
}

function showQuestion() {
    if (currentIndex >= currentPool.length) {
        checkRoundEnd();
        return;
    }

    const currentQ = currentPool[currentIndex];
    document.getElementById('progress-text').innerText = `é€²åº¦ï¼š${currentIndex + 1} / ${currentPool.length}`;
    document.getElementById('word-display').innerText = currentQ.w;
    document.getElementById('feedback').innerText = "";
    
    const optionsBox = document.getElementById('options-box');
    optionsBox.innerHTML = "";

    // ç”Ÿæˆé¸é …ï¼š1æ­£ + 3èª¤
    let options = [currentQ];
    let distractors = allWordsInArticle.filter(v => v.w !== currentQ.w);
    options.push(...shuffle(distractors).slice(0, 3));
    options = shuffle(options);

    options.forEach(opt => {
        const btn = document.createElement('button');
        btn.className = 'btn';
        // è™•ç† ã€Œ/ã€ï¼šåªå–ç¬¬ä¸€å€‹
        btn.innerText = opt.d.split('/')[0].trim();
        btn.onclick = () => {
            if (opt.w === currentQ.w) {
                btn.classList.add('correct');
                document.getElementById('feedback').innerText = "Correct! âœ…";
                setTimeout(nextQuestion, 1000);
            } else {
                btn.classList.add('wrong');
                document.getElementById('feedback').innerText = `Wrong! Correct: ${currentQ.d.split('/')[0].trim()}`;
                if (!wrongFromLastRound.find(x => x.w === currentQ.w)) {
                    wrongFromLastRound.push(currentQ);
                }
                setTimeout(nextQuestion, 2000);
            }
            disableButtons();
        };
        optionsBox.appendChild(btn);
    });
}

function nextQuestion() {
    currentIndex++;
    showQuestion();
}

function disableButtons() {
    const btns = document.querySelectorAll('#options-box .btn');
    btns.forEach(b => b.style.pointerEvents = 'none');
}

function checkRoundEnd() {
    if (wrongFromLastRound.length === 0) {
        document.getElementById('quiz-screen').classList.add('hidden');
        document.getElementById('result-screen').classList.remove('hidden');
    } else {
        alert(`é€™è¼ªå®Œæˆï¼ä½ æœ‰ ${wrongFromLastRound.length} é¡Œç­”éŒ¯ï¼Œç¾åœ¨é–‹å§‹é‡è€ƒã€‚`);
        // æº–å‚™ä¸‹ä¸€è¼ªï¼šåŒ…å«éŒ¯é¡Œï¼Œè‹¥ä¸è¶³5é¡Œå‰‡è£œæ–°é¡Œ
        let nextRound = [...wrongFromLastRound];
        let remaining = allWordsInArticle.filter(v => !nextRound.includes(v));
        while (nextRound.length < 5 && remaining.length > 0) {
            nextRound.push(remaining.pop());
        }
        startNewRound(nextRound);
    }
}

function shuffle(array) {
    return array.sort(() => Math.random() - 0.5);
}
</script>
</body>
</html>
